<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Fuel Cell Explorer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ===== GLOBAL RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #808080;
            --accent: #ffffff;
            --accent-hover: #f0f0f0;
            --border: #333333;
            --shadow: rgba(0, 0, 0, 0.5);
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            font-feature-settings: 'liga', 'kern';
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ===== BREATHING ANIMATION KEYFRAMES ===== */
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.1); }
            50% { box-shadow: 0 0 30px rgba(255, 255, 255, 0.2); }
        }

        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* ===== MAIN LAYOUT ===== */
        #app-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            background: radial-gradient(circle at 30% 20%, #1a1a1a 0%, #0a0a0a 100%);
        }

        #canvas-container {
            flex: 1;
            position: relative;
            cursor: grab;
        }

        #canvas-container:active {
            cursor: grabbing;
        }

        /* ===== CONTROL PANEL STYLES ===== */
        #control-panel {
            position: absolute;
            top: 32px;
            left: 32px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 20px 40px var(--shadow);
            z-index: 1000;
            min-width: 320px;
            animation: slideInLeft 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ===== MOBILE DROPDOWN STYLES ===== */
        #mobile-dropdown-btn {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 12px;
            color: var(--text-primary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #mobile-dropdown-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .mobile-collapsed {
            transform: translateX(-100%);
            opacity: 0;
            pointer-events: none;
        }

        .mobile-expanded {
            transform: translateX(0);
            opacity: 1;
            pointer-events: all;
        }

        #control-panel h2 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 24px;
            color: var(--text-primary);
            letter-spacing: -0.02em;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        #control-panel h2::before {
            content: "⚡";
            font-size: 1.5rem;
        }

        .mode-section {
            margin-bottom: 24px;
        }

        .mode-section h3 {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 16px;
        }

        .mode-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .mode-btn {
            padding: 16px 20px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
            color: var(--text-secondary);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .mode-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .mode-btn:hover::before {
            left: 100%;
        }

        .mode-btn:hover {
            border-color: var(--accent);
            color: var(--text-primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 255, 255, 0.1);
        }

        .mode-btn.active {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
            box-shadow: 0 8px 20px rgba(255, 255, 255, 0.2);
        }

        .mode-btn.active:hover {
            background: var(--accent-hover);
        }

        .reset-btn {
            width: 100%;
            padding: 16px;
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .reset-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .reset-btn:hover::before {
            left: 100%;
        }

        .reset-btn:hover {
            border-color: #ff4444;
            color: #ff4444;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 68, 68, 0.2);
        }

        .instructions {
            margin-top: 24px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            font-size: 0.875rem;
            line-height: 1.6;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .instructions:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .instructions strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .instructions-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }

        .instructions-item::before {
            content: "→";
            color: var(--accent);
            font-weight: bold;
        }

        /* ===== INFO PANEL STYLES ===== */
        #info-panel {
            position: absolute;
            top: 32px;
            right: 32px;
            width: 360px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 20px 40px var(--shadow);
            z-index: 1000;
            display: none;
            animation: slideInRight 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #info-panel:hover {
            animation: breathe 3s ease-in-out infinite;
            background: rgba(255, 255, 255, 0.08);
        }

        #info-panel h3 {
            color: var(--text-primary);
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: -0.02em;
            line-height: 1.3;
        }

        #info-panel .component-function {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--accent);
        }

        #info-panel p {
            line-height: 1.7;
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 16px;
        }

        /* ===== ASSEMBLY PANEL STYLES ===== */
        #assembly-panel {
            position: absolute;
            bottom: 32px;
            left: 32px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 28px;
            box-shadow: 0 20px 40px var(--shadow);
            z-index: 1000;
            display: none;
            min-width: 320px;
            animation: slideInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #assembly-panel:hover {
            animation: breathe 3s ease-in-out infinite;
            background: rgba(255, 255, 255, 0.08);
        }

        #assembly-panel h4 {
            margin-bottom: 20px;
            color: var(--text-primary);
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 12px 0;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffffff, #f0f0f0);
            width: 0%;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 4px;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .assembly-complete {
            color: var(--accent) !important;
            font-weight: 600;
            font-size: 1rem;
        }

        /* ===== WELCOME OVERLAY ===== */
        #welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .welcome-content {
            background: var(--glass);
            backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 48px;
            text-align: center;
            max-width: 500px;
        }

        .welcome-content h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .welcome-content p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 32px;
            line-height: 1.6;
        }

        .welcome-btn {
            padding: 16px 32px;
            background: var(--accent);
            color: var(--bg-primary);
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .welcome-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(255, 255, 255, 0.2);
        }

        /* ===== CONTROL HINTS ===== */
        #control-hints {
            position: absolute;
            bottom: 32px;
            right: 32px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px;
            z-index: 1000;
            animation: slideInRight 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hint-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 8px 0;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .hint-icon {
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1024px) {
            #control-panel, #info-panel, #assembly-panel {
                min-width: 280px;
                padding: 24px;
            }
            
            #control-panel {
                top: 20px;
                left: 20px;
            }
            
            #info-panel {
                top: 20px;
                right: 20px;
                width: 320px;
            }
            
            #assembly-panel {
                bottom: 20px;
                left: 20px;
            }
        }

        @media (max-width: 768px) {
            /* Show mobile dropdown button */
            #mobile-dropdown-btn {
                display: block;
            }

            /* Hide control hints on mobile */
            #control-hints {
                display: none;
            }

            /* Mobile control panel styles */
            #control-panel {
                position: fixed;
                top: 70px;
                left: 16px;
                right: 16px;
                width: auto;
                min-width: auto;
                max-height: 70vh;
                overflow-y: auto;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            /* Mobile info panel styles */
            #info-panel {
                position: fixed;
                top: 70px;
                left: 16px;
                right: 16px;
                width: auto;
                max-height: 70vh;
                overflow-y: auto;
            }
            
            /* Mobile assembly panel styles */
            #assembly-panel {
                position: fixed;
                bottom: 16px;
                left: 16px;
                right: 16px;
                width: auto;
                min-width: auto;
            }

            /* Compact mobile styles */
            #control-panel h2 {
                font-size: 1.5rem;
                margin-bottom: 20px;
            }

            .mode-buttons {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .instructions {
                padding: 16px;
                font-size: 0.825rem;
            }

            .modal-content {
                margin: 20px;
                padding: 32px 24px;
                max-height: 90vh;
            }

            .modal-header h2 {
                font-size: 2rem;
            }

            .stack-steps {
                gap: 16px;
            }

            .stack-step {
                padding: 16px;
            }
        }

        @media (max-width: 480px) {
            #mobile-dropdown-btn {
                top: 16px;
                left: 16px;
                padding: 10px;
                font-size: 1rem;
            }

            #control-panel {
                top: 60px;
                padding: 20px;
            }

            .modal-content {
                margin: 10px;
                padding: 24px 20px;
            }

            .modal-header h2 {
                font-size: 1.75rem;
            }

            .reaction-equation {
                font-size: 1rem;
                padding: 20px;
            }
        }

        /* ===== COMPLETION MODAL STYLES ===== */
        #completion-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(15px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            animation: modalFadeIn 0.5s ease forwards;
        }

        @keyframes modalFadeIn {
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--glass);
            backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
        }

        @keyframes modalSlideIn {
            from { transform: translateY(50px) scale(0.9); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .modal-header h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .modal-header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 300;
        }

        .modal-section {
            margin-bottom: 32px;
        }

        .modal-section h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-section p {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .stack-steps {
            display: grid;
            gap: 20px;
            margin: 24px 0;
        }

        .stack-step {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .stack-step:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(8px);
        }

        .step-number {
            background: var(--accent);
            color: var(--bg-primary);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .step-content h4 {
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .step-content p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin: 0;
        }

        .reaction-equation {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            color: var(--accent);
            margin: 20px 0;
            letter-spacing: 0.05em;
        }

        .modal-footer {
            text-align: center;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid var(--glass-border);
        }

        .close-modal-btn {
            padding: 16px 32px;
            background: var(--accent);
            color: var(--bg-primary);
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 0 8px;
        }

        .close-modal-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(255, 255, 255, 0.2);
        }

        .close-modal-btn.secondary {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .close-modal-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        /* ===== LOADING ANIMATION ===== */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="app-container">
        <!-- Mobile Dropdown Button -->
        <button id="mobile-dropdown-btn" onclick="window.fuelCellApp.toggleMobileDropdown()">
            ☰
        </button>

        <!-- Main Canvas Container -->
        <div id="canvas-container"></div>

        <!-- Control Panel -->
        <div id="control-panel">
            <h2>Fuel Cell Explorer</h2>
            
            <div class="mode-section">
                <h3>Mode Selection</h3>
                <div class="mode-buttons">
                    <button id="explore-mode" class="mode-btn active">
                        🔍 Explore
                    </button>
                    <button id="assemble-mode" class="mode-btn">
                        🔧 Assemble
                    </button>
                </div>
            </div>
            
            <button id="reset-btn" class="reset-btn">↻ Reset Assembly</button>
            
            <div class="instructions">
                <div id="explore-instructions">
                    <strong>🔍 Explore Mode</strong>
                    <div class="instructions-item">Click components for detailed info</div>
                    <div class="instructions-item">Drag to rotate view 360°</div>
                    <div class="instructions-item">Scroll wheel to zoom in/out</div>
                    <div class="instructions-item">Right-click drag to pan</div>
                </div>
                <div id="assemble-instructions" style="display: none;">
                    <strong>🔧 Assembly Mode</strong>
                    <div class="instructions-item">Left-click drag components to assemble</div>
                    <div class="instructions-item">Right-click drag to orbit view</div>
                    <div class="instructions-item">Components snap when placed correctly</div>
                    <div class="instructions-item">Watch progress in bottom panel</div>
                </div>
            </div>
        </div>

        <!-- Component Information Panel -->
        <div id="info-panel">
            <div id="component-info">
                <h3>Component Information</h3>
                <p>Click on any fuel cell component to learn about its function and role in the electrochemical process.</p>
            </div>
        </div>

        <!-- Assembly Progress Panel -->
        <div id="assembly-panel">
            <h4>⚡ Assembly Progress</h4>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text" id="progress-text">Components assembled: 0/9</div>
            </div>
        </div>

        <!-- Control Hints -->
        <div id="control-hints">
            <div class="hint-item">
                <div class="hint-icon">🖱️</div>
                <span id="hint-drag">Drag to rotate</span>
            </div>
            <div class="hint-item">
                <div class="hint-icon">⚙️</div>
                <span>Scroll to zoom</span>
            </div>
            <div class="hint-item">
                <div class="hint-icon">👆</div>
                <span id="hint-click">Click to explore</span>
            </div>
        </div>

        <!-- Welcome Overlay -->
        <div id="welcome-overlay">
            <div class="welcome-content">
                <h2>🚀 Welcome to Fuel Cell Explorer</h2>
                <p>Discover how hydrogen fuel cells work through interactive 3D exploration and hands-on assembly.</p>
                <button class="welcome-btn" onclick="this.parentElement.parentElement.style.display='none'">
                    Start Exploring
                </button>
            </div>
        </div>

        <!-- Completion Modal -->
        <div id="completion-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>🎉 Fuel Cell Assembly Complete!</h2>
                    <p>Congratulations! You've successfully assembled a hydrogen fuel cell.</p>
                </div>

                <div class="modal-section">
                    <h3>⚡ How the Fuel Cell Works</h3>
                    <p>A hydrogen fuel cell generates electricity through an electrochemical reaction between hydrogen and oxygen, producing only water and heat as byproducts. This clean energy conversion process occurs in three main steps:</p>
                    
                    <div class="stack-steps">
                        <div class="stack-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Hydrogen Oxidation (Anode)</h4>
                                <p>Hydrogen molecules (H₂) enter through the inlet and are split by the catalyst at the anode into protons (H⁺) and electrons (e⁻).</p>
                            </div>
                        </div>
                        <div class="stack-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Proton Transport (PEM)</h4>
                                <p>Protons pass through the Proton Exchange Membrane while electrons are forced through an external circuit, generating electrical current.</p>
                            </div>
                        </div>
                        <div class="stack-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Oxygen Reduction (Cathode)</h4>
                                <p>At the cathode, oxygen combines with protons and electrons to form pure water (H₂O), which exits through the water outlet.</p>
                            </div>
                        </div>
                    </div>

                    <div class="reaction-equation">
                        2H₂ + O₂ → 2H₂O + Electricity + Heat
                    </div>
                </div>

                <div class="modal-section">
                    <h3>📚 Stack Assembly Order</h3>
                    <p>The fuel cell components are assembled in a specific layered structure to ensure optimal performance:</p>
                    
                    <div class="stack-steps">
                        <div class="stack-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Bipolar Plates (Foundation)</h4>
                                <p>Provide structural support and electrical connection between multiple cells in a stack configuration.</p>
                            </div>
                        </div>
                        <div class="stack-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Gas Diffusion Layers</h4>
                                <p>Enable uniform gas distribution and provide electrical conductivity between electrodes and plates.</p>
                            </div>
                        </div>
                        <div class="stack-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Flow Fields & Electrodes</h4>
                                <p>Channel networks (flow fields) distribute gases evenly across the electrodes (anode and cathode) on either side of the membrane.</p>
                            </div>
                        </div>
                        <div class="stack-step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Proton Exchange Membrane (Core)</h4>
                                <p>The selective membrane at the center allows only protons to pass while blocking electrons, creating the electrical potential.</p>
                            </div>
                        </div>
                        <div class="stack-step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <h4>Gas Inlets & Water Outlet</h4>
                                <p>Manifolds supply hydrogen fuel and air while removing the water byproduct to maintain optimal operating conditions.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-section">
                    <h3>🌍 Environmental Impact</h3>
                    <p>Fuel cells represent a clean energy technology with zero harmful emissions. When powered by renewable hydrogen, they offer a sustainable solution for transportation, stationary power generation, and energy storage applications.</p>
                </div>

                <div class="modal-footer">
                    <button class="close-modal-btn secondary" onclick="window.fuelCellApp.resetAssembly(); document.getElementById('completion-modal').style.display='none';">
                        Try Again
                    </button>
                    <button class="close-modal-btn" onclick="document.getElementById('completion-modal').style.display='none';">
                        Continue Exploring
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        /**
         * ====================================================================
         * INTERACTIVE FUEL CELL VISUALIZATION - ENHANCED VERSION
         * ====================================================================
         * 
         * FEATURES:
         * • Fixed orbit controls with proper 360° rotation and zoom
         * • Beautiful black/white/gray UI design with smooth animations
         * • Improved typography and spacing
         * • Breathing animations and hover effects
         * • Professional control panels with glassmorphism
         * • Responsive design for all screen sizes
         * 
         * ====================================================================
         */

        class FuelCellExplorer {
            constructor() {
                // === Core Three.js Components ===
                this.scene = new THREE.Scene();
                this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                this.renderer = new THREE.WebGLRenderer({ 
                    antialias: true, 
                    alpha: true,
                    powerPreference: "high-performance"
                });
                
                // === Application State ===
                this.currentMode = 'explore';
                this.isDragging = false;
                this.selectedComponent = null;
                this.mousePosition = new THREE.Vector2();
                this.raycaster = new THREE.Raycaster();
                this.controls = null;
                this.isMobileDropdownOpen = false;
                
                // === Component Management ===
                this.components = [];
                this.assembledComponents = new Set();
                this.assemblyTargets = new Map();
                this.dragPlane = new THREE.Plane(new THREE.Vector3(0, 0, 1), 0);
                
                this.initialize();
            }

            /**
             * Initialize all application systems
             */
            initialize() {
                this.setupRenderer();
                this.setupCamera();
                this.setupLighting();
                this.setupOrbitControls();
                this.createFuelCellComponents();
                this.defineAssemblyTargets();
                this.setupEventListeners();
                this.initializeMobileResponsive();
                this.startRenderLoop();
                
                console.log('🚀 Fuel Cell Explorer initialized successfully');
            }

            /**
             * Configure the WebGL renderer with optimal settings
             */
            setupRenderer() {
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                this.renderer.setClearColor(0x000000, 0);
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                this.renderer.outputEncoding = THREE.sRGBEncoding;
                
                document.getElementById('canvas-container').appendChild(this.renderer.domElement);
            }

            /**
             * Position and configure the camera for optimal viewing
             */
            setupCamera() {
                this.camera.position.set(12, 8, 12);
                this.camera.lookAt(0, 0, 0);
            }

            /**
             * Create comprehensive lighting for realistic rendering
             */
            setupLighting() {
                // Ambient light for overall scene illumination
                const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
                this.scene.add(ambientLight);

                // Main directional light with shadows
                const mainLight = new THREE.DirectionalLight(0xffffff, 0.8);
                mainLight.position.set(15, 15, 10);
                mainLight.castShadow = true;
                mainLight.shadow.mapSize.width = 2048;
                mainLight.shadow.mapSize.height = 2048;
                mainLight.shadow.camera.near = 0.5;
                mainLight.shadow.camera.far = 50;
                this.scene.add(mainLight);

                // Fill light for balanced illumination
                const fillLight = new THREE.DirectionalLight(0x8fc1e3, 0.3);
                fillLight.position.set(-10, 5, -5);
                this.scene.add(fillLight);

                // Rim light for visual separation
                const rimLight = new THREE.DirectionalLight(0xffc649, 0.2);
                rimLight.position.set(0, -10, 10);
                this.scene.add(rimLight);
            }

            /**
             * Setup orbit controls with FIXED implementation for 360° rotation and zoom
             * Now supports right-click orbit in assembly mode
             */
            setupOrbitControls() {
                // Manual OrbitControls implementation to ensure it works
                let isLeftMouseDown = false;
                let isRightMouseDown = false;
                let mouseX = 0, mouseY = 0;
                let targetRotationX = 0, targetRotationY = 0;
                let rotationX = 0, rotationY = 0;
                
                const canvas = this.renderer.domElement;
                
                // Mouse down event
                canvas.addEventListener('mousedown', (event) => {
                    if (event.button === 0) { // Left click
                        if (this.currentMode === 'explore' && !this.isDragging) {
                            isLeftMouseDown = true;
                            mouseX = event.clientX;
                            mouseY = event.clientY;
                            canvas.style.cursor = 'grabbing';
                        }
                    } else if (event.button === 2) { // Right click
                        // Always allow right-click orbit in both modes
                        isRightMouseDown = true;
                        mouseX = event.clientX;
                        mouseY = event.clientY;
                        canvas.style.cursor = 'grabbing';
                        event.preventDefault(); // Prevent context menu
                    }
                });
                
                // Mouse move event for rotation
                canvas.addEventListener('mousemove', (event) => {
                    if ((isLeftMouseDown && this.currentMode === 'explore') || isRightMouseDown) {
                        const deltaX = event.clientX - mouseX;
                        const deltaY = event.clientY - mouseY;
                        
                        targetRotationY += deltaX * 0.01;
                        targetRotationX += deltaY * 0.01;
                        
                        // Clamp vertical rotation
                        targetRotationX = Math.max(-Math.PI/2, Math.min(Math.PI/2, targetRotationX));
                        
                        mouseX = event.clientX;
                        mouseY = event.clientY;
                    }
                });
                
                // Mouse up event
                canvas.addEventListener('mouseup', (event) => {
                    if (event.button === 0) {
                        isLeftMouseDown = false;
                    } else if (event.button === 2) {
                        isRightMouseDown = false;
                    }
                    canvas.style.cursor = 'grab';
                });
                
                // Mouse leave event
                canvas.addEventListener('mouseleave', () => {
                    isLeftMouseDown = false;
                    isRightMouseDown = false;
                    canvas.style.cursor = 'grab';
                });
                
                // Zoom functionality with mouse wheel
                canvas.addEventListener('wheel', (event) => {
                    event.preventDefault();
                    
                    const zoomSpeed = 0.1;
                    const zoomDirection = event.deltaY > 0 ? 1 : -1;
                    
                    // Get current distance from origin
                    const currentDistance = this.camera.position.length();
                    const newDistance = Math.max(5, Math.min(30, currentDistance + zoomDirection * zoomSpeed * currentDistance));
                    
                    // Scale camera position to new distance
                    this.camera.position.multiplyScalar(newDistance / currentDistance);
                }, { passive: false });
                
                // Animation loop for smooth rotation
                const updateCamera = () => {
                    // Smooth rotation interpolation
                    rotationX += (targetRotationX - rotationX) * 0.1;
                    rotationY += (targetRotationY - rotationY) * 0.1;
                    
                    // Calculate camera position based on rotation
                    const distance = this.camera.position.length();
                    this.camera.position.x = distance * Math.sin(rotationY) * Math.cos(rotationX);
                    this.camera.position.y = distance * Math.sin(rotationX);
                    this.camera.position.z = distance * Math.cos(rotationY) * Math.cos(rotationX);
                    
                    // Always look at the center
                    this.camera.lookAt(0, 0, 0);
                    
                    requestAnimationFrame(updateCamera);
                };
                
                updateCamera();
                
                console.log('📹 Enhanced orbit controls initialized with right-click support');
            }

            /**
             * Create all fuel cell components with enhanced details
             */
            createFuelCellComponents() {
                const componentSpecs = {
                    // === CORE ELECTROCHEMICAL COMPONENTS ===
                    protonMembrane: {
                        geometry: new THREE.BoxGeometry(0.1, 4, 2.5),
                        material: new THREE.MeshLambertMaterial({ 
                            color: 0xe91e63,
                            transparent: true,
                            opacity: 0.8
                        }),
                        position: [0, 0, 0],
                        name: 'Proton Exchange Membrane (PEM)',
                        description: 'The selective membrane at the heart of the fuel cell that allows only protons to pass through while blocking electrons, creating the essential electrical potential difference that drives current flow.',
                        function: 'Conducts protons while blocking electrons'
                    },
                    
                    anode: {
                        geometry: new THREE.BoxGeometry(0.3, 4, 2.5),
                        material: new THREE.MeshLambertMaterial({ color: 0x2196f3 }),
                        position: [-0.5, 0, 0],
                        name: 'Anode (Negative Electrode)',
                        description: 'The negative electrode where hydrogen molecules undergo catalytic oxidation, splitting into protons and electrons. This process initiates the entire electrochemical reaction chain.',
                        function: 'Oxidizes hydrogen into protons and electrons'
                    },
                    
                    cathode: {
                        geometry: new THREE.BoxGeometry(0.3, 4, 2.5),
                        material: new THREE.MeshLambertMaterial({ color: 0xf44336 }),
                        position: [0.5, 0, 0],
                        name: 'Cathode (Positive Electrode)',
                        description: 'The positive electrode where the reduction reaction occurs. Oxygen molecules combine with protons and electrons to form pure water, completing the electrochemical circuit.',
                        function: 'Reduces oxygen with protons and electrons to form water'
                    },
                    
                    // === FLOW DISTRIBUTION SYSTEMS ===
                    hydrogenFlowField: {
                        geometry: new THREE.BoxGeometry(0.25, 3.5, 2),
                        material: new THREE.MeshLambertMaterial({ color: 0xff9800 }),
                        position: [-1.2, 0, 0],
                        name: 'Hydrogen Flow Field',
                        description: 'Precisely engineered channels that ensure uniform distribution of hydrogen gas across the entire anode surface, maximizing fuel utilization efficiency and reaction completeness.',
                        function: 'Distributes hydrogen fuel uniformly across anode'
                    },
                    
                    oxygenFlowField: {
                        geometry: new THREE.BoxGeometry(0.25, 3.5, 2),
                        material: new THREE.MeshLambertMaterial({ color: 0x03a9f4 }),
                        position: [1.2, 0, 0],
                        name: 'Oxygen Flow Field',
                        description: 'Specialized channel network that distributes atmospheric air (containing oxygen) evenly across the cathode surface, ensuring optimal oxidant supply for complete electrochemical reactions.',
                        function: 'Distributes oxygen/air uniformly across cathode'
                    },
                    
                    // === GAS INLET/OUTLET SYSTEMS ===
                    hydrogenInlet: {
                        geometry: new THREE.BoxGeometry(2, 0.4, 0.4),
                        material: new THREE.MeshLambertMaterial({ color: 0xffeb3b }),
                        position: [-2.5, 2.2, 0],
                        name: 'Hydrogen Gas Inlet',
                        description: 'The primary fuel input manifold where pressurized, purified hydrogen gas enters the fuel cell system at controlled flow rates and pressure levels.',
                        function: 'Supplies high-purity hydrogen fuel to the system'
                    },
                    
                    airInlet: {
                        geometry: new THREE.BoxGeometry(2, 0.4, 0.4),
                        material: new THREE.MeshLambertMaterial({ color: 0x00bcd4 }),
                        position: [2.5, 2.2, 0],
                        name: 'Air/Oxygen Inlet',
                        description: 'The oxidant input port through which filtered atmospheric air enters the system, providing the oxygen necessary for the reduction reaction at the cathode.',
                        function: 'Supplies atmospheric air containing oxygen'
                    },
                    
                    waterOutlet: {
                        geometry: new THREE.BoxGeometry(1.5, 0.4, 0.4),
                        material: new THREE.MeshLambertMaterial({ color: 0x4caf50 }),
                        position: [0, -2.5, 0],
                        name: 'Water Outlet',
                        description: 'The product removal port where ultra-pure water (the only byproduct of the fuel cell reaction) is continuously expelled to prevent system flooding and maintain optimal performance.',
                        function: 'Removes pure water produced by the reaction'
                    },
                    
                    // === STRUCTURAL SUPPORT SYSTEMS ===
                    gasDiffusionLayers: {
                        geometry: new THREE.BoxGeometry(0.6, 4.2, 2.7),
                        material: new THREE.MeshLambertMaterial({ 
                            color: 0x9e9e9e,
                            transparent: true,
                            opacity: 0.7
                        }),
                        position: [0, 0, -2],
                        name: 'Gas Diffusion Layers',
                        description: 'Microporous carbon-based backing layers that provide structural support, electrical conductivity, and facilitate uniform gas distribution while managing water transport.',
                        function: 'Supports structure and enables uniform gas distribution'
                    },
                    
                    bipolarPlates: {
                        geometry: new THREE.BoxGeometry(3, 4.5, 0.3),
                        material: new THREE.MeshLambertMaterial({ color: 0x455a64 }),
                        position: [0, 0, -3],
                        name: 'Bipolar Plates',
                        description: 'Conductive separator plates that provide electrical connections between adjacent cells in a fuel cell stack while maintaining gas separation and structural integrity.',
                        function: 'Provides electrical connection and inter-cell separation'
                    }
                };

                // Create component objects from specifications
                Object.entries(componentSpecs).forEach(([id, spec]) => {
                    const component = new FuelCellComponent(id, spec);
                    this.components.push(component);
                    this.scene.add(component.mesh);
                });
                
                console.log(`⚡ Created ${this.components.length} enhanced fuel cell components`);
            }

            /**
             * Define precise assembly positions for each component
             */
            defineAssemblyTargets() {
                this.assemblyTargets.set('bipolarPlates', new THREE.Vector3(0, 0, -1.5));
                this.assemblyTargets.set('gasDiffusionLayers', new THREE.Vector3(0, 0, -1));
                this.assemblyTargets.set('hydrogenFlowField', new THREE.Vector3(-0.8, 0, 0));
                this.assemblyTargets.set('anode', new THREE.Vector3(-0.3, 0, 0));
                this.assemblyTargets.set('protonMembrane', new THREE.Vector3(0, 0, 0));
                this.assemblyTargets.set('cathode', new THREE.Vector3(0.3, 0, 0));
                this.assemblyTargets.set('oxygenFlowField', new THREE.Vector3(0.8, 0, 0));
                this.assemblyTargets.set('hydrogenInlet', new THREE.Vector3(-2, 1.8, 0));
                this.assemblyTargets.set('airInlet', new THREE.Vector3(2, 1.8, 0));
                this.assemblyTargets.set('waterOutlet', new THREE.Vector3(0, -2, 0));
            }

            /**
             * Setup all user interaction event listeners
             */
            setupEventListeners() {
                // Mode switching buttons
                document.getElementById('explore-mode').addEventListener('click', () => this.switchMode('explore'));
                document.getElementById('assemble-mode').addEventListener('click', () => this.switchMode('assemble'));
                document.getElementById('reset-btn').addEventListener('click', () => this.resetAssembly());

                // Assembly mode mouse events
                this.renderer.domElement.addEventListener('mousedown', (e) => this.handleMouseDown(e));
                this.renderer.domElement.addEventListener('mousemove', (e) => this.handleMouseMove(e));
                this.renderer.domElement.addEventListener('mouseup', (e) => this.handleMouseUp(e));
                this.renderer.domElement.addEventListener('click', (e) => this.handleClick(e));

                // Window resize handling
                window.addEventListener('resize', () => this.handleWindowResize());
                
                // Prevent context menu on right click
                this.renderer.domElement.addEventListener('contextmenu', (e) => e.preventDefault());
                
                console.log('🎮 Enhanced event listeners initialized');
            }

            /**
             * Switch between Explore and Assemble modes with smooth transitions
             */
            switchMode(mode) {
                this.currentMode = mode;
                
                // Update UI button states with animation
                document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`${mode}-mode`).classList.add('active');
                
                // Show/hide relevant UI panels with animations
                const infoPanel = document.getElementById('info-panel');
                const assemblyPanel = document.getElementById('assembly-panel');
                const exploreInstructions = document.getElementById('explore-instructions');
                const assembleInstructions = document.getElementById('assemble-instructions');
                
                // Update control hints based on mode
                const hintDrag = document.getElementById('hint-drag');
                const hintClick = document.getElementById('hint-click');
                
                if (mode === 'explore') {
                    infoPanel.style.display = 'block';
                    assemblyPanel.style.display = 'none';
                    exploreInstructions.style.display = 'block';
                    assembleInstructions.style.display = 'none';
                    
                    // Update hints for explore mode
                    if (hintDrag) hintDrag.textContent = 'Drag to rotate';
                    if (hintClick) hintClick.textContent = 'Click to explore';
                } else {
                    infoPanel.style.display = 'none';
                    assemblyPanel.style.display = 'block';
                    exploreInstructions.style.display = 'none';
                    assembleInstructions.style.display = 'block';
                    this.updateAssemblyProgress();
                    
                    // Update hints for assembly mode
                    if (hintDrag) hintDrag.textContent = 'Right-click to rotate';
                    if (hintClick) hintClick.textContent = 'Left-click to assemble';
                }
                
                // Close mobile dropdown after mode switch
                if (this.isMobileDropdownOpen && window.innerWidth <= 768) {
                    this.toggleMobileDropdown();
                }
                
                console.log(`🔄 Switched to ${mode} mode`);
            }

            /**
             * Handle mouse down events for drag initiation
             */
            handleMouseDown(event) {
                // Only handle left-click for assembly dragging
                if (this.currentMode !== 'assemble' || event.button !== 0) return;

                const intersected = this.getIntersectedObject(event);
                if (intersected) {
                    this.isDragging = true;
                    this.selectedComponent = intersected;
                    
                    // Visual feedback for selected component
                    this.selectedComponent.material.emissive.setHex(0x444444);
                    this.renderer.domElement.style.cursor = 'grabbing';
                }
            }

            /**
             * Handle mouse move events for dragging components
             */
            handleMouseMove(event) {
                if (!this.isDragging || !this.selectedComponent) return;

                // Calculate new position based on mouse movement
                this.updateMousePosition(event);
                this.raycaster.setFromCamera(this.mousePosition, this.camera);
                
                const intersection = new THREE.Vector3();
                if (this.raycaster.ray.intersectPlane(this.dragPlane, intersection)) {
                    this.selectedComponent.position.copy(intersection);
                }
            }

            /**
             * Handle mouse up events for drop and snapping
             */
            handleMouseUp(event) {
                if (this.isDragging && this.selectedComponent) {
                    // Reset visual feedback
                    this.selectedComponent.material.emissive.setHex(0x000000);
                    this.renderer.domElement.style.cursor = 'grab';
                    
                    // Check for assembly snapping
                    this.checkAssemblySnap(this.selectedComponent);
                    
                    // Reset dragging state
                    this.isDragging = false;
                    this.selectedComponent = null;
                    
                    this.updateAssemblyProgress();
                }
            }

            /**
             * Handle click events for component information display
             */
            handleClick(event) {
                // Only handle left-click for component info and ignore if dragging
                if (this.currentMode !== 'explore' || this.isDragging || event.button !== 0) return;

                const intersected = this.getIntersectedObject(event);
                if (intersected) {
                    const component = this.components.find(c => c.mesh === intersected);
                    if (component) {
                        this.displayComponentInfo(component);
                    }
                }
            }

            /**
             * Get the intersected 3D object from mouse position
             */
            getIntersectedObject(event) {
                this.updateMousePosition(event);
                this.raycaster.setFromCamera(this.mousePosition, this.camera);
                
                const intersects = this.raycaster.intersectObjects(this.components.map(c => c.mesh));
                return intersects.length > 0 ? intersects[0].object : null;
            }

            /**
             * Update normalized mouse position coordinates
             */
            updateMousePosition(event) {
                this.mousePosition.x = (event.clientX / window.innerWidth) * 2 - 1;
                this.mousePosition.y = -(event.clientY / window.innerHeight) * 2 + 1;
            }

            /**
             * Display detailed information about a component with enhanced formatting
             */
            displayComponentInfo(component) {
                const infoDiv = document.getElementById('component-info');
                infoDiv.innerHTML = `
                    <h3>${component.name}</h3>
                    <div class="component-function">${component.function}</div>
                    <p>${component.description}</p>
                `;
                
                console.log(`ℹ️ Displaying enhanced info for: ${component.name}`);
            }

            /**
             * Check if a component should snap to its assembly position
             */
            checkAssemblySnap(object) {
                const component = this.components.find(c => c.mesh === object);
                if (!component) return;

                const targetPosition = this.assemblyTargets.get(component.id);
                if (!targetPosition) return;

                const distance = object.position.distanceTo(targetPosition);
                const snapThreshold = 2.0;

                if (distance < snapThreshold) {
                    // Snap to correct position with smooth animation
                    object.position.copy(targetPosition);
                    this.assembledComponents.add(component.id);
                    
                    // Enhanced visual feedback
                    object.material.emissive.setHex(0x004400);
                    
                    console.log(`✅ ${component.name} assembled correctly`);
                } else {
                    this.assembledComponents.delete(component.id);
                    object.material.emissive.setHex(0x000000);
                }
            }

            /**
             * Update the assembly progress with enhanced animations
             */
            updateAssemblyProgress() {
                const totalComponents = this.components.length;
                const assembledCount = this.assembledComponents.size;
                const progressPercent = (assembledCount / totalComponents) * 100;
                
                // Update progress bar with smooth animation
                const progressFill = document.getElementById('progress-fill');
                progressFill.style.width = `${progressPercent}%`;
                
                // Update progress text
                const progressText = document.getElementById('progress-text');
                progressText.innerHTML = `Components assembled: ${assembledCount}/${totalComponents}`;
                
                // Check for completion with celebration and modal
                if (assembledCount === totalComponents) {
                    progressText.innerHTML += '<br><span class="assembly-complete">🎉 Fuel Cell Assembly Complete!</span>';
                    
                    // Show completion modal after a brief delay
                    setTimeout(() => {
                        this.showCompletionModal();
                    }, 1500);
                    
                    console.log('🎉 Fuel cell assembly completed - showing educational modal!');
                }
            }

            /**
             * Show the completion modal with fuel cell operation explanation
             */
            showCompletionModal() {
                const modal = document.getElementById('completion-modal');
                modal.style.display = 'flex';
                
                // Add close functionality with escape key
                const closeModal = (event) => {
                    if (event.key === 'Escape' || event.target === modal) {
                        modal.style.display = 'none';
                        document.removeEventListener('keydown', closeModal);
                    }
                };
                
                document.addEventListener('keydown', closeModal);
                modal.addEventListener('click', closeModal);
                
                // Prevent closing when clicking inside modal content
                modal.querySelector('.modal-content').addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            }

            /**
             * Toggle mobile dropdown panel visibility
             */
            toggleMobileDropdown() {
                const controlPanel = document.getElementById('control-panel');
                const dropdownBtn = document.getElementById('mobile-dropdown-btn');
                
                this.isMobileDropdownOpen = !this.isMobileDropdownOpen;
                
                if (this.isMobileDropdownOpen) {
                    controlPanel.classList.remove('mobile-collapsed');
                    controlPanel.classList.add('mobile-expanded');
                    dropdownBtn.textContent = '✕';
                } else {
                    controlPanel.classList.remove('mobile-expanded');
                    controlPanel.classList.add('mobile-collapsed');
                    dropdownBtn.textContent = '☰';
                }
            }

            /**
             * Initialize mobile responsive behavior
             */
            initializeMobileResponsive() {
                const controlPanel = document.getElementById('control-panel');
                
                // Check if mobile view
                const checkMobile = () => {
                    const isMobile = window.innerWidth <= 768;
                    
                    if (isMobile) {
                        // Start with collapsed state on mobile
                        controlPanel.classList.add('mobile-collapsed');
                        this.isMobileDropdownOpen = false;
                        document.getElementById('mobile-dropdown-btn').textContent = '☰';
                    } else {
                        // Remove mobile classes on desktop
                        controlPanel.classList.remove('mobile-collapsed', 'mobile-expanded');
                        this.isMobileDropdownOpen = false;
                    }
                };
                
                // Initial check
                checkMobile();
                
                // Listen for resize events
                window.addEventListener('resize', checkMobile);
            }

            /**
             * Reset all components to their original positions
             */
            resetAssembly() {
                this.assembledComponents.clear();
                
                this.components.forEach(component => {
                    component.resetPosition();
                });
                
                this.updateAssemblyProgress();
                
                // Close mobile dropdown after reset
                if (this.isMobileDropdownOpen && window.innerWidth <= 768) {
                    this.toggleMobileDropdown();
                }
                
                console.log('🔄 Assembly reset');
            }

            /**
             * Handle window resize events
             */
            handleWindowResize() {
                this.camera.aspect = window.innerWidth / window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth, window.innerHeight);
            }

            /**
             * Main render loop with smooth 60fps animation
             */
            startRenderLoop() {
                const animate = () => {
                    requestAnimationFrame(animate);
                    this.renderer.render(this.scene, this.camera);
                };
                
                animate();
                console.log('🎬 Enhanced render loop started');
            }
        }

        /**
         * Enhanced Fuel Cell Component Class
         */
        class FuelCellComponent {
            constructor(id, spec) {
                this.id = id;
                this.name = spec.name;
                this.description = spec.description;
                this.function = spec.function;
                
                // Create the 3D mesh with enhanced properties
                this.mesh = new THREE.Mesh(spec.geometry, spec.material);
                this.mesh.position.set(...spec.position);
                this.mesh.castShadow = true;
                this.mesh.receiveShadow = true;
                
                // Store original transform for reset functionality
                this.originalPosition = this.mesh.position.clone();
                this.originalRotation = this.mesh.rotation.clone();
                
                console.log(`🔧 Enhanced component created: ${this.name}`);
            }

            /**
             * Reset component to original position with smooth transition
             */
            resetPosition() {
                this.mesh.position.copy(this.originalPosition);
                this.mesh.rotation.copy(this.originalRotation);
                this.mesh.material.emissive.setHex(0x000000);
            }
        }

        /**
         * Initialize the enhanced application
         */
        window.addEventListener('load', () => {
            // Create and start the enhanced fuel cell explorer
            const app = new FuelCellExplorer();
            window.fuelCellApp = app;
            
            console.log('🌟 Enhanced Fuel Cell Explorer loaded successfully!');
            
            // Auto-hide welcome overlay after 4 seconds
            setTimeout(() => {
                const overlay = document.getElementById('welcome-overlay');
                if (overlay.style.display !== 'none') {
                    overlay.style.opacity = '0';
                    setTimeout(() => overlay.style.display = 'none', 500);
                }
            }, 4000);
        });

     
    </script>
</body>
</html>